<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pin-in-Paste – Volume de pâte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- On réutilise le manifest et l'icône de l'appli -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Outils CMS">
  <link rel="apple-touch-icon" href="icon_192.png">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color-scheme: light;
    }
    body {
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
    }
    .app {
      max-width: 760px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.25rem 1.5rem 1.5rem;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start; /* IMPORTANT: pour que le lien soit en haut */
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    h1 {
      font-size: 1.3rem;
      margin: 0;
    }
    .subtitle {
      font-size: 0.8rem;
      color: #555;
    }
    a.back {
      font-size: 0.8rem;
      text-decoration: none;
      color: #007aff;
      margin-top: 0.2rem;
      white-space: nowrap;
    }

    .pip-figure {
      margin: 0 0 0.8rem;
    }
    .pip-figure img {
      width: 100%;
      display: block;
      border-radius: 8px;
    }

    .section-title {
      font-weight: 600;
      margin-top: 0.6rem;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem 1rem;
      margin-bottom: 0.75rem;
    }
    label {
      font-size: 0.85rem;
      display: block;
    }
    input {
      width: 100%;
      margin-top: 0.25rem;
      padding: 0.4rem 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem;
      margin-top: 0.25rem;
      font-size: 0.85rem;
    }

   .radio-option {
     display: inline-flex;
     align-items: center;
     gap: 0.4rem;
     white-space: nowrap;
    }

   .radio-option input[type="radio"] {
     margin: 0;
     width: 16px;
     height: 16px;
    }

    .outputs {
      margin-top: 0.8rem;
      border-top: 1px solid #e3e3e3;
      padding-top: 0.8rem;
      font-size: 0.9rem;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 0.2rem 0;
      align-items: baseline;
      gap: 0.5rem;
    }
    .value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      white-space: nowrap;
    }
    .ok {
      background: #d4edda;
      color: #155724;
    }
    .warn {
      background: #fff3cd;
      color: #856404;
    }
    .bad {
      background: #f8d7da;
      color: #721c24;
    }
    .note {
      font-size: 0.75rem;
      color: #555;
      margin-top: 0.5rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Pin-in-Paste – Volume de pâte</h1>
      <div class="subtitle">
        Estimation du volume de pâte à déposer par pin (approximation).
      </div>
    </div>
    <a href="index.html" class="back">← Ratio pochoir</a>
  </header>

  <!-- L’illustration est maintenant EN DEHORS du header -->
  <figure class="pip-figure">
    <img src="pip_schema.png" alt="Principe du Pin-in-Paste : dépôt de pâte dans le trou, insertion de la broche, refusion.">
  </figure>

  <div class="section-title">1. Trou et broche (en mm)</div>
  <div class="grid">
    <label>
      Diamètre du trou D<sub>trou</sub> [mm]
      <input id="pip_d_hole" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <div>
      Type de broche
      <div class="radio-group">
       <label class="radio-option">
        <input type="radio" name="pip_pin_shape" value="round" checked onchange="pip_updatePinShape()">
        <span>Ronde</span>
       </label>
       <label class="radio-option">
        <input type="radio" name="pip_pin_shape" value="rect" onchange="pip_updatePinShape()">
        <span>Rectangulaire</span>
       </label>
      </div>
    </div>
  </div>

  <div id="pip_pin_round" class="grid">
    <label>
      Diamètre de la broche D<sub>pin</sub> [mm]
      <input id="pip_d_pin" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
  </div>

  <div id="pip_pin_rect" class="grid" style="display:none">
    <label>
      Largeur broche W<sub>pin</sub> [mm]
      <input id="pip_w_pin" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Épaisseur broche T<sub>pin</sub> [mm]
      <input id="pip_t_pin" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
  </div>

  <div class="grid">
    <label>
      Épaisseur de la carte t<sub>carte</sub> [mm]
      <input id="pip_t_board" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Coefficient k (fillets, pertes)
      <input id="pip_k" type="number" step="0.05" inputmode="decimal" value="1.20" oninput="pip_calculate()">
    </label>
  </div>

  <div class="section-title">2. Pochoir et ouverture (en mm)</div>
  <div class="grid">
    <label>
      Épaisseur du pochoir t<sub>pochoir</sub> [mm]
      <input id="pip_t_stencil" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Nombre d'ouvertures par pin
      <input id="pip_n_ap" type="number" step="1" inputmode="numeric" value="1" oninput="pip_calculate()">
    </label>
    <label>
      Largeur ouverture a [mm]
      <input id="pip_a" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Longueur ouverture b [mm]
      <input id="pip_b" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
  </div>

  <div class="outputs">
    <div class="row">
      <span>Surface trou A<sub>trou</sub> [mm²]</span>
      <span class="value" id="pip_a_hole">–</span>
    </div>
    <div class="row">
      <span>Surface broche A<sub>pin</sub> [mm²]</span>
      <span class="value" id="pip_a_pin">–</span>
    </div>
    <div class="row">
      <span>Volume annulaire V<sub>annulaire</sub> (trou − broche) [mm³]</span>
      <span class="value" id="pip_v_annular">–</span>
    </div>
    <div class="row">
      <span>Volume de soudure requis V<sub>soudure</sub> = k · V<sub>annulaire</sub> [mm³]</span>
      <span class="value" id="pip_v_solder">–</span>
    </div>
    <div class="row">
      <span>Volume de pâte requis V<sub>pâte, requis</sub> [mm³]</span>
      <span class="value" id="pip_v_paste_req">–</span>
    </div>
    <div class="row">
      <span>Volume de pâte fourni V<sub>pâte, fourni</sub> [mm³]</span>
      <span class="value" id="pip_v_paste_avail">–</span>
    </div>
    <div class="row">
      <span>Ratio V<sub>fourni</sub> / V<sub>requis</sub></span>
      <span>
        <span class="value" id="pip_ratio">–</span>
        <span id="pip_status" class="badge">–</span>
      </span>
    </div>

    <p class="note">
      Hypothèses :<br>
      • Toutes les longueurs sont saisies en mm, les volumes affichés sont en mm³.<br>
      • A<sub>trou</sub> = π·D<sub>trou</sub>²/4.<br>
      • A<sub>pin</sub> = π·D<sub>pin</sub>²/4 pour une broche ronde, ou W<sub>pin</sub>·T<sub>pin</sub> pour une broche rectangulaire.<br>
      • V<sub>annulaire</sub> = (A<sub>trou</sub> − A<sub>pin</sub>)·t<sub>carte</sub> (barillet rempli de soudure).<br>
      • V<sub>soudure</sub> = k·V<sub>annulaire</sub> (k typiquement 1,1 à 1,3).<br>
      • On suppose ~50 % de métal en volume dans la pâte → V<sub>pâte, requis</sub> ≈ 2·V<sub>soudure</sub>.<br>
      • V<sub>pâte, fourni</sub> = N<sub>ouvertures</sub>·(a·b)·t<sub>pochoir</sub>.<br>
      • Ratio entre ~0,9 et 1,3 généralement acceptable ; &lt; 1 → risque de sous-remplissage, &gt; 1,5 → risque d'excès.
    </p>
  </div>
</div>

<script>
const PIP_METAL_FRACTION = 0.5; // 50 % de métal en volume

function pip_updatePinShape() {
  const shape = document.querySelector('input[name="pip_pin_shape"]:checked').value;
  document.getElementById('pip_pin_round').style.display = (shape === 'round') ? 'grid' : 'none';
  document.getElementById('pip_pin_rect').style.display = (shape === 'rect') ? 'grid' : 'none';
  pip_calculate();
}

function pip_parse(id) {
  const v = parseFloat(document.getElementById(id).value);
  return isFinite(v) && v > 0 ? v : null;
}

function pip_fmt(x) {
  return Number.isFinite(x) ? x.toFixed(2) : '–';
}

function pip_calculate() {
  const d_hole = pip_parse('pip_d_hole');
  const t_board = pip_parse('pip_t_board');
  const k = pip_parse('pip_k');
  const t_stencil = pip_parse('pip_t_stencil');
  const n_ap = pip_parse('pip_n_ap');
  const a = pip_parse('pip_a');
  const b = pip_parse('pip_b');

  const a_hole_el = document.getElementById('pip_a_hole');
  const a_pin_el = document.getElementById('pip_a_pin');
  const v_annular_el = document.getElementById('pip_v_annular');
  const v_solder_el = document.getElementById('pip_v_solder');
  const v_paste_req_el = document.getElementById('pip_v_paste_req');
  const v_paste_av_el = document.getElementById('pip_v_paste_avail');
  const ratio_el = document.getElementById('pip_ratio');
  const status_el = document.getElementById('pip_status');

  function resetAll() {
    a_hole_el.textContent = '–';
    a_pin_el.textContent = '–';
    v_annular_el.textContent = '–';
    v_solder_el.textContent = '–';
    v_paste_req_el.textContent = '–';
    v_paste_av_el.textContent = '–';
    ratio_el.textContent = '–';
    status_el.textContent = '–';
    status_el.className = 'badge';
  }

  if (!d_hole || !t_board || !k) {
    resetAll();
    return;
  }

  const area_hole = Math.PI * Math.pow(d_hole, 2) / 4;

  const shape = document.querySelector('input[name="pip_pin_shape"]:checked').value;
  let area_pin = null;

  if (shape === 'round') {
    const d_pin = pip_parse('pip_d_pin');
    if (!d_pin) { resetAll(); return; }
    area_pin = Math.PI * Math.pow(d_pin, 2) / 4;
    if (d_pin >= d_hole) { resetAll(); return; }
  } else {
    const w_pin = pip_parse('pip_w_pin');
    const t_pin = pip_parse('pip_t_pin');
    if (!w_pin || !t_pin) { resetAll(); return; }
    area_pin = w_pin * t_pin;
    if (area_pin >= area_hole) { resetAll(); return; }
  }

  a_hole_el.textContent = pip_fmt(area_hole);
  a_pin_el.textContent = pip_fmt(area_pin);

  const v_annular = (area_hole - area_pin) * t_board;
  const v_solder = k * v_annular;
  const v_paste_req = v_solder / PIP_METAL_FRACTION;

  v_annular_el.textContent = pip_fmt(v_annular);
  v_solder_el.textContent = pip_fmt(v_solder);
  v_paste_req_el.textContent = pip_fmt(v_paste_req);

  let v_paste_avail = null;
  let ratio = null;

  if (a && b && t_stencil && n_ap) {
    const area_ap = a * b;
    v_paste_avail = area_ap * t_stencil * n_ap;
    ratio = v_paste_avail / v_paste_req;
  }

  v_paste_av_el.textContent = pip_fmt(v_paste_avail);
  ratio_el.textContent = Number.isFinite(ratio) ? ratio.toFixed(2) : '–';

  status_el.className = 'badge';
  if (!Number.isFinite(ratio)) {
    status_el.textContent = '–';
    return;
  }

  if (ratio < 0.9) {
    status_el.textContent = 'Trop faible';
    status_el.className = 'badge bad';
  } else if (ratio <= 1.3) {
    status_el.textContent = 'OK';
    status_el.className = 'badge ok';
  } else if (ratio <= 1.5) {
    status_el.textContent = 'Élevé';
    status_el.className = 'badge warn';
  } else {
    status_el.textContent = 'Très élevé';
    status_el.className = 'badge bad';
  }
}
</script>
</body>
</html>

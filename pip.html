<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pin-in-Paste – Volume de pâte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Outils CMS">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color-scheme: light;
    }
    body {
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
    }
    .app {
      max-width: 760px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.25rem 1.5rem 1.5rem;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    h1 {
      font-size: 1.3rem;
      margin: 0;
    }
    .subtitle {
      font-size: 0.8rem;
      color: #555;
    }
    a.back {
      font-size: 0.8rem;
      text-decoration: none;
      color: #007aff;
    }

    .section-title {
      font-weight: 600;
      margin-top: 0.6rem;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem 1rem;
      margin-bottom: 0.75rem;
    }
    label {
      font-size: 0.85rem;
      display: block;
    }
    input, select {
      width: 100%;
      margin-top: 0.25rem;
      padding: 0.4rem 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    .radio-group {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.25rem;
      font-size: 0.85rem;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .outputs {
      margin-top: 0.8rem;
      border-top: 1px solid #e3e3e3;
      padding-top: 0.8rem;
      font-size: 0.9rem;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 0.2rem 0;
      align-items: baseline;
      gap: 0.5rem;
    }
    .value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      white-space: nowrap;
    }
    .ok {
      background: #d4edda;
      color: #155724;
    }
    .warn {
      background: #fff3cd;
      color: #856404;
    }
    .bad {
      background: #f8d7da;
      color: #721c24;
    }
    .note {
      font-size: 0.75rem;
      color: #555;
      margin-top: 0.5rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Pin-in-Paste – Volume de pâte</h1>
      <div class="subtitle">
        Estimation du volume de pâte à braser à déposer par pin (approximation).
      </div>
    </div>
    <a href="index.html" class="back">← Retour ratio pochoir</a>
  </header>

  <div class="section-title">1. Trou et composant (en mm)</div>
  <div class="grid">
    <label>
      Diamètre du trou D<sub>trou</sub> [mm]
      <input id="pip_d_hole" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Diamètre de la patte D<sub>pin</sub> [mm]
      <input id="pip_d_pin" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Épaisseur de la carte t<sub>carte</sub> [mm]
      <input id="pip_t_board" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Coefficient k (fillet, pertes)
      <input id="pip_k" type="number" step="0.05" inputmode="decimal" value="1.20" oninput="pip_calculate()">
    </label>
  </div>

  <div class="section-title">2. Pochoir et ouverture (en mm)</div>
  <div class="grid">
    <label>
      Épaisseur du pochoir t<sub>pochoir</sub> [mm]
      <input id="pip_t_stencil" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Nombre d'ouvertures par pin
      <input id="pip_n_ap" type="number" step="1" inputmode="numeric" value="1" oninput="pip_calculate()">
    </label>
    <div>
      Type d'ouverture
      <div class="radio-group">
        <label>
          <input type="radio" name="pip_shape" value="rect" checked onchange="pip_updateShape()"> Rectangulaire
        </label>
        <label>
          <input type="radio" name="pip_shape" value="round" onchange="pip_updateShape()"> Ronde
        </label>
      </div>
    </div>
  </div>

  <div id="pip_rect_inputs" class="grid">
    <label>
      Largeur ouverture a [mm]
      <input id="pip_a" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
    <label>
      Longueur ouverture b [mm]
      <input id="pip_b" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
  </div>

  <div id="pip_round_inputs" class="grid" style="display:none">
    <label>
      Diamètre ouverture D<sub>ap</sub> [mm]
      <input id="pip_d_ap" type="number" step="0.01" inputmode="decimal" oninput="pip_calculate()">
    </label>
  </div>

  <div class="outputs">
    <div class="row">
      <span>Volume annulaire V<sub>annulaire</sub> (trou − pin)</span>
      <span class="value" id="pip_v_annular">–</span>
    </div>
    <div class="row">
      <span>Volume de soudure requis V<sub>soudure</sub> = k · V<sub>annulaire</sub></span>
      <span class="value" id="pip_v_solder">–</span>
    </div>
    <div class="row">
      <span>Volume de pâte requis V<sub>pâte, requis</sub></span>
      <span class="value" id="pip_v_paste_req">–</span>
    </div>
    <div class="row">
      <span>Volume de pâte fourni V<sub>pâte, fourni</sub></span>
      <span class="value" id="pip_v_paste_avail">–</span>
    </div>
    <div class="row">
      <span>Ratio V<sub>fourni</sub> / V<sub>requis</sub></span>
      <span>
        <span class="value" id="pip_ratio">–</span>
        <span id="pip_status" class="badge">–</span>
      </span>
    </div>

    <p class="note">
      Hypothèses :<br>
      • Toutes les longueurs sont saisies en mm, les volumes affichés sont en mm³.<br>
      • V<sub>annulaire</sub> ≈ (π/4)·(D<sub>trou</sub>² − D<sub>pin</sub>²)·t<sub>carte</sub> (barillet entièrement rempli).<br>
      • V<sub>soudure</sub> = k·V<sub>annulaire</sub> pour prendre en compte les fillets et pertes (k typiquement 1,1 à 1,3).<br>
      • On suppose ≈50 % de métal en volume dans la pâte → V<sub>pâte, requis</sub> ≈ 2·V<sub>soudure</sub>.<br>
      • V<sub>pâte, fourni</sub> = N<sub>ouvertures</sub>·Surface<sub>ouverture</sub>·t<sub>pochoir</sub>.<br>
      • Ratio entre ~0,9 et 1,3 est généralement acceptable ; &lt; 1 → risque de sous-remplissage, &gt; 1,5 → risque d'excès.
    </p>
  </div>
</div>

<script>
const PIP_METAL_FRACTION = 0.5; // 50 % de métal en volume

function pip_updateShape() {
  const shape = document.querySelector('input[name="pip_shape"]:checked').value;
  document.getElementById('pip_rect_inputs').style.display = (shape === 'rect') ? 'grid' : 'none';
  document.getElementById('pip_round_inputs').style.display = (shape === 'round') ? 'grid' : 'none';
  pip_calculate();
}

function pip_parse(id) {
  const v = parseFloat(document.getElementById(id).value);
  return isFinite(v) && v > 0 ? v : null;
}

function pip_fmt(x) {
  return Number.isFinite(x) ? x.toFixed(2) : '–';
}

function pip_calculate() {
  const d_hole = pip_parse('pip_d_hole');
  const d_pin = pip_parse('pip_d_pin');
  const t_board = pip_parse('pip_t_board');
  const k = pip_parse('pip_k');
  const t_stencil = pip_parse('pip_t_stencil');
  const n_ap = pip_parse('pip_n_ap');

  const shape = document.querySelector('input[name="pip_shape"]:checked').value;
  let area_ap = null;

  if (shape === 'rect') {
    const a = pip_parse('pip_a');
    const b = pip_parse('pip_b');
    if (a && b) area_ap = a * b;
  } else {
    const d_ap = pip_parse('pip_d_ap');
    if (d_ap) area_ap = Math.PI * Math.pow(d_ap, 2) / 4;
  }

  const v_annular_el = document.getElementById('pip_v_annular');
  const v_solder_el = document.getElementById('pip_v_solder');
  const v_paste_req_el = document.getElementById('pip_v_paste_req');
  const v_paste_av_el = document.getElementById('pip_v_paste_avail');
  const ratio_el = document.getElementById('pip_ratio');
  const status_el = document.getElementById('pip_status');

  // Si données insuffisantes, on reset
  if (!d_hole || !d_pin || !t_board || !k || d_hole <= d_pin) {
    v_annular_el.textContent = '–';
    v_solder_el.textContent = '–';
    v_paste_req_el.textContent = '–';
    v_paste_av_el.textContent = '–';
    ratio_el.textContent = '–';
    status_el.textContent = '–';
    status_el.className = 'badge';
    return;
  }

  // Volume annulaire
  const v_annular = Math.PI * (Math.pow(d_hole, 2) - Math.pow(d_pin, 2)) * t_board / 4;
  const v_solder = k * v_annular;
  const v_paste_req = v_solder / PIP_METAL_FRACTION;

  v_annular_el.textContent = pip_fmt(v_annular);
  v_solder_el.textContent = pip_fmt(v_solder);
  v_paste_req_el.textContent = pip_fmt(v_paste_req);

  let v_paste_avail = null;
  let ratio = null;

  if (area_ap && t_stencil && n_ap) {
    v_paste_avail = area_ap * t_stencil * n_ap;
    ratio = v_paste_avail / v_paste_req;
  }

  v_paste_av_el.textContent = pip_fmt(v_paste_avail);
  ratio_el.textContent = ratio ? ratio.toFixed(2) : '–';

  status_el.className = 'badge';
  if (!ratio) {
    status_el.textContent = '–';
    return;
  }

  if (ratio < 0.9) {
    status_el.textContent = 'Trop faible';
    status_el.className = 'badge bad';
  } else if (ratio <= 1.3) {
    status_el.textContent = 'OK';
    status_el.className = 'badge ok';
  } else if (ratio <= 1.5) {
    status_el.textContent = 'Élevé';
    status_el.className = 'badge warn';
  } else {
    status_el.textContent = 'Très élevé';
    status_el.className = 'badge bad';
  }
}
</script>
</body>
</html>

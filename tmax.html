<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Épaisseur max du pochoir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Outils CMS">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color-scheme: light;
    }
    body {
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
    }
    .app {
      max-width: 760px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.25rem 1.5rem 1.5rem;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    h1 {
      font-size: 1.3rem;
      margin: 0;
    }
    .subtitle {
      font-size: 0.8rem;
      color: #555;
    }
    a.back {
      font-size: 0.8rem;
      text-decoration: none;
      color: #007aff;
      margin-top: 0.2rem;
      white-space: nowrap;
    }

    .section-title {
      font-weight: 600;
      margin-top: 0.6rem;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem 1rem;
      margin-bottom: 0.75rem;
    }
    label {
      font-size: 0.85rem;
      display: block;
    }
    input {
      width: 100%;
      margin-top: 0.25rem;
      padding: 0.4rem 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    .outputs {
      margin-top: 0.8rem;
      border-top: 1px solid #e3e3e3;
      padding-top: 0.8rem;
      font-size: 0.9rem;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 0.2rem 0;
      align-items: baseline;
      gap: 0.5rem;
    }
    .value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      white-space: nowrap;
      background: #e9ecef;
      color: #495057;
    }
    .note {
      font-size: 0.75rem;
      color: #555;
      margin-top: 0.5rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Épaisseur max du pochoir</h1>
      <div class="subtitle">
        Épaisseur maximale respectant a/t ≥ 1,50 et area ratio ≥ 0,66 pour une ouverture donnée.
      </div>
    </div>
    <a href="index.html" class="back">← Ratio pochoir</a>
  </header>

  <div class="section-title">1. Dimensions de l'ouverture (même unité)</div>
  <div class="grid">
    <label>
      a – petite largeur de l'ouverture
      <input id="tmax_a" type="number" step="0.01" inputmode="decimal" oninput="tmax_calculate()">
    </label>
    <label>
      b – grande longueur de l'ouverture
      <input id="tmax_b" type="number" step="0.01" inputmode="decimal" oninput="tmax_calculate()">
    </label>
    <label>
      r – rayon des coins
      <input id="tmax_r" type="number" step="0.01" inputmode="decimal" oninput="tmax_calculate()">
    </label>
  </div>

  <div class="section-title">2. Seuils à respecter</div>
  <div class="grid">
    <label>
      Seuil aspect ratio (a / t) min
      <input id="tmax_ar_min" type="number" step="0.01" inputmode="decimal" value="1.50" oninput="tmax_calculate()">
    </label>
    <label>
      Seuil area ratio min
      <input id="tmax_area_min" type="number" step="0.01" inputmode="decimal" value="0.66" oninput="tmax_calculate()">
    </label>
  </div>

  <div class="outputs">
    <div class="row">
      <span>t<sub>max, Règle 1</sub> (aspect ratio) [même unité que a]</span>
      <span class="value" id="tmax_rule1">–</span>
    </div>
    <div class="row">
      <span>t<sub>max, Règle 2</sub> (area ratio) [même unité que a]</span>
      <span class="value" id="tmax_rule2">–</span>
    </div>
    <div class="row">
      <span>Épaisseur max recommandée t<sub>max</sub></span>
      <span>
        <span class="value" id="tmax_global">–</span>
        <span class="badge" id="tmax_limiting">–</span>
      </span>
    </div>
    <div class="row">
      <span>Aspect ratio a / t<sub>max</sub></span>
      <span class="value" id="tmax_ar_val">–</span>
    </div>
    <div class="row">
      <span>Area ratio à t<sub>max</sub></span>
      <span class="value" id="tmax_area_val">–</span>
    </div>

    <p class="note">
      Hypothèses :<br>
      • a, b, r et t sont dans la même unité (par exemple µm).<br>
      • Aspect ratio = a / t. Règle 1 : a / t ≥ seuil (par défaut 1,50).<br>
      • Area ratio = (a·b − r²(4−π)) / (2·t·[a + b + r(π−4)]). Règle 2 : area ratio ≥ seuil (par défaut 0,66).<br>
      • t<sub>max, Règle 1</sub> = a / (seuil aspect ratio).<br>
      • t<sub>max, Règle 2</sub> = (a·b − r²(4−π)) / (2·(a + b + r(π−4))·seuil area ratio).<br>
      • t<sub>max</sub> = min(t<sub>max, Règle 1</sub>, t<sub>max, Règle 2</sub>).<br>
      • Aspect ratio et area ratio affichés sont calculés à t = t<sub>max</sub> recommandé.<br>
      • Si les résultats restent vides (–), vérifier les valeurs saisies (rayon trop grand, a ou b nuls, etc.).
    </p>
  </div>
</div>

<script>
function tmax_parse(id) {
  const v = parseFloat(document.getElementById(id).value);
  return isFinite(v) && v > 0 ? v : null;
}

function tmax_fmt(x) {
  return Number.isFinite(x) ? x.toFixed(2) : '–';
}

function tmax_calculate() {
  const a = tmax_parse('tmax_a');
  const b = tmax_parse('tmax_b');
  const r = tmax_parse('tmax_r');
  const ar_min = tmax_parse('tmax_ar_min');
  const area_min = tmax_parse('tmax_area_min');

  const rule1El = document.getElementById('tmax_rule1');
  const rule2El = document.getElementById('tmax_rule2');
  const globalEl = document.getElementById('tmax_global');
  const limitingEl = document.getElementById('tmax_limiting');
  const arValEl = document.getElementById('tmax_ar_val');
  const areaValEl = document.getElementById('tmax_area_val');

  // reset
  rule1El.textContent = '–';
  rule2El.textContent = '–';
  globalEl.textContent = '–';
  limitingEl.textContent = '–';
  arValEl.textContent = '–';
  areaValEl.textContent = '–';

  if (!a || !b || !r || !ar_min || !area_min) {
    return;
  }

  // Règle 1 : a/t >= ar_min  → t <= a / ar_min
  const tmax_rule1 = a / ar_min;

  // Règle 2 : area_ratio = A / (2 t P) >= area_min
  const A = a * b - r * r * (4 - Math.PI);
  const P = a + b + r * (Math.PI - 4);

  let tmax_rule2 = NaN;
  if (A > 0 && P > 0) {
    tmax_rule2 = A / (2 * P * area_min);
  }

  rule1El.textContent = tmax_fmt(tmax_rule1);
  rule2El.textContent = tmax_fmt(tmax_rule2);

  const candidates = [tmax_rule1, tmax_rule2].filter(x => Number.isFinite(x) && x > 0);
  if (candidates.length === 0) {
    return;
  }

  const tmax = Math.min.apply(null, candidates);
  globalEl.textContent = tmax_fmt(tmax);

  // règle limitante
  if (Math.abs(tmax - tmax_rule1) < Math.abs(tmax - tmax_rule2)) {
    limitingEl.textContent = 'Règle limitante : Règle 1 (a / t)';
  } else if (Number.isFinite(tmax_rule2)) {
    limitingEl.textContent = 'Règle limitante : Règle 2 (area ratio)';
  } else {
    limitingEl.textContent = 'Règle limitante : Règle 1 (a / t)';
  }

  // Aspect ratio et area ratio à tmax
  if (Number.isFinite(tmax) && A > 0 && P > 0) {
    const ar_at_t = a / tmax;
    const area_at_t = A / (2 * tmax * P);
    arValEl.textContent = ar_at_t.toFixed(2);
    areaValEl.textContent = area_at_t.toFixed(3);
  }
}
</script>
</body>
</html>
